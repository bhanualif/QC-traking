<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>QC Tracking</title>
  <style>
    * { box-sizing: border-box; font-family: "Segoe UI", Arial, sans-serif; }
    body {
      background: linear-gradient(135deg, #2563eb, #1e40af);
      color: #1e293b;
      margin: 0;
      padding: 40px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      padding: 30px;
      width: 100%;
      max-width: 500px;
      animation: fadeIn 0.6s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #1e3a8a;
    }

    h3 {
      border-left: 4px solid #2563eb;
      padding-left: 10px;
      color: #334155;
      margin-top: 25px;
    }

    form {
      background: #f8fafc;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      transition: 0.3s;
    }

    form:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    label { font-weight: 600; display: block; margin-bottom: 4px; color: #475569; }
    input {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      font-size: 0.95rem;
      transition: 0.2s;
    }
    input:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37,99,235,0.15);
      outline: none;
    }

    button {
      width: 100%;
      background: #2563eb;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      transition: 0.3s;
    }
    button:hover {
      background: #1e40af;
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(37,99,235,0.3);
    }

    .log {
      background: #f8fafc;
      border-radius: 12px;
      padding: 20px;
      width: 100%;
      min-height: 100px;
      font-size: 0.9rem;
      color: #1e293b;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
      overflow-y: auto;
    }

    .btn-refresh {
      background: #10b981;
    }
    .btn-refresh:hover {
      background: #059669;
      box-shadow: 0 4px 10px rgba(16,185,129,0.3);
    }

    .btn-logout {
      background: #ef4444;
      color: white;
      margin-bottom: 20px;
    }
    .btn-logout:hover {
      background: #b91c1c;
      box-shadow: 0 4px 10px rgba(239,68,68,0.3);
    }

    footer {
      margin-top: 20px;
      text-align: center;
      color: #cbd5e1;
      font-size: 0.8rem;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>QC Tracking</h1>
    <button class="btn-logout" id="logoutBtn">üö™ Logout</button>

    <h3>1Ô∏è‚É£ Input Device</h3>
    <form id="deviceForm">
      <label>Device ID</label>
      <input type="text" id="deviceId" placeholder="misal: SBX-0001" required>
      <label>Device Name</label>
      <input type="text" id="deviceName" placeholder="misal: sound box premium" required>
      <button type="submit">Tambah Device</button>
    </form>

    <h3>2Ô∏è‚É£ QC Checklist</h3>
    <form id="qcForm">
      <label>Device ID</label>
      <input type="text" id="qcDeviceId" placeholder="misal: SBX-0001" required>
      <button type="submit">Checklist QC</button>
    </form>

    <h3>üìã Log Aktivitas</h3>
    <div class="log" id="log"></div>

    <button class="btn-refresh" onclick="refreshData()">üîÑ Refresh Data</button>

    <footer>¬© 2025 QC Tracking | v2.0</footer>
  </div>

  <script>
    const API_BASE = "http://localhost:3000";
    const token = localStorage.getItem("token");
    const logBox = document.getElementById("log");

    // Cek login
    if (!token) {
      alert("‚ö†Ô∏è Harus login dulu!");
      window.location.href = "login.html";
    }

    function addLog(msg) {
      const time = new Date().toLocaleTimeString("id-ID", { hour12: false });
      logBox.innerHTML += `[${time}] ${msg}<br>`;
      logBox.scrollTop = logBox.scrollHeight;
    }

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", async () => {
      await fetch(`${API_BASE}/logout`, { 
        method: "POST", 
        headers: { "Authorization": token } 
      });
      localStorage.removeItem("token");
      window.location.href = "login.html";
    });

    // Tambah device
    document.getElementById("deviceForm").addEventListener("submit", async e => {
      e.preventDefault();
      const id = document.getElementById("deviceId").value.trim();
      const name = document.getElementById("deviceName").value.trim();
      try {
        const res = await fetch(`${API_BASE}/devices`, {
          method: "POST",
          headers: { "Content-Type": "application/json", "Authorization": token },
          body: JSON.stringify({ deviceId: id, deviceName: name })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error);
        addLog(`‚úÖ ${data.message}`);
        e.target.reset();
        refreshData();
      } catch (err) {
        addLog(`‚ùå ${err.message}`);
      }
    });

    // QC device
    document.getElementById("qcForm").addEventListener("submit", async e => {
      e.preventDefault();
      const id = document.getElementById("qcDeviceId").value.trim();
      try {
        const res = await fetch(`${API_BASE}/qc`, {
          method: "POST",
          headers: { "Content-Type": "application/json", "Authorization": token },
          body: JSON.stringify({ deviceId: id })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error);
        addLog(`‚úÖ ${data.message}`);
        e.target.reset();
        refreshData();
      } catch (err) {
        addLog(`‚ùå ${err.message}`);
      }
    });

    // Refresh data
    async function refreshData() {
      try {
        const [devRes, qcRes] = await Promise.all([
          fetch(`${API_BASE}/devices`, { headers: { "Authorization": token } }),
          fetch(`${API_BASE}/qc`, { headers: { "Authorization": token } })
        ]);
        const dev = await devRes.json();
        const qc = await qcRes.json();
        addLog(`üìä Total Device: ${dev.data.length} | QC OK: ${qc.data.length}`);
      } catch {
        addLog("‚ö†Ô∏è Gagal memuat data dari server");
      }
    }

    // Load awal
    refreshData();
  </script>
</body>
</html>
